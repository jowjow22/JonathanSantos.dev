# Migration Guide: Next.js to React + Vite + TanStack Router

## Overview
This guide provides a comprehensive roadmap for migrating your portfolio website from Next.js to a React + Vite + TanStack Router setup. The main motivations for this migration are:
- **Cost reduction**: Deploy on cheaper alternatives to AWS Amplify
- **Better performance**: Leverage Vite's fast development and build times
- **Reduced bundle size**: Remove unused Next.js features
- **More control**: Fine-tune exactly what your application needs

## Current Architecture Analysis

### Dependencies That Need Migration
- Next.js routing → TanStack Router
- Server-side data fetching → Client-side with React Query
- `next/link` → `@tanstack/react-router` Link
- File-based routing → Route configuration
- Next.js Image optimization → Manual implementation or third-party solution

### Potential Challenges
1. **Server-Side Rendering (SSR) Dependencies**
   - `fetchArticles()` function needs conversion to client-side
   - Loss of automatic SEO optimization
   - Need to implement client-side data fetching patterns

2. **Routing Architecture**
   - File-based routing conversion to TanStack Router
   - Dynamic routes and nested layouts restructuring

3. **Build and Deployment Changes**
   - Static asset handling differences
   - Environment variable configuration
   - Bundle optimization strategies

## Migration Roadmap

### Phase 1: Project Setup (1-2 days)

#### Step 1.1: Create New Vite Project
```bash
# Create new Vite project
npm create vite@latest jonathan-santos-portfolio -- --template react-ts
cd jonathan-santos-portfolio
npm install
```

#### Step 1.2: Install Required Dependencies
```bash
# Core dependencies
npm install @tanstack/react-router @tanstack/react-query
npm install react-hook-form @radix-ui/react-label @radix-ui/react-slot
npm install @tabler/icons-react

# Development dependencies
npm install -D @tanstack/router-vite-plugin @tanstack/router-devtools
npm install -D @types/react @types/react-dom
npm install -D tailwindcss postcss autoprefixer
npm install -D vitest @testing-library/react @testing-library/jest-dom
```

#### Step 1.3: Initialize Tailwind CSS
```bash
npx tailwindcss init -p
```

### Phase 2: Configure Vite and TanStack Router (1 day)

#### Step 2.1: Configure Vite
Create `vite.config.ts`:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { TanStackRouterVite } from '@tanstack/router-vite-plugin'
import path from 'path'

export default defineConfig({
  plugins: [react(), TanStackRouterVite()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
      },
    },
  },
})
```

#### Step 2.2: Configure Tailwind CSS
Update `tailwind.config.js`:
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        poppins: ['Poppins', 'sans-serif'],
      },
      screens: {
        'xs': '475px',
        '2xs': '375px',
      },
    },
  },
  plugins: [],
}
```

#### Step 2.3: Setup Route Tree
Create `src/routeTree.gen.ts` (this will be auto-generated):
```typescript
// This file is auto-generated by TanStack Router
```

### Phase 3: Migrate Components (2-3 days)

#### Step 3.1: Copy Component Structure
```bash
# Copy your existing components
cp -r src/app/components src/
cp -r src/components/ui src/components/
cp -r src/lib src/
cp -r src/hooks src/
```

#### Step 3.2: Update Import Paths
Replace all Next.js specific imports:

**Before (Next.js):**
```typescript
import Link from 'next/link'
import Image from 'next/image'
```

**After (React + Vite):**
```typescript
import { Link } from '@tanstack/react-router'
// Use regular img tag or implement custom Image component
```

#### Step 3.3: Update Components
Update components that use Next.js Link:

**Example: Update Button component links**
```typescript
// In your components, replace:
<Link href="/about">
  <Button>About</Button>
</Link>

// With:
<Link to="/about">
  <Button>About</Button>
</Link>
```

### Phase 4: Convert Pages to Routes (2 days)

#### Step 4.1: Create Root Route
Create `src/routes/__root.tsx`:
```typescript
import { createRootRoute, Outlet } from '@tanstack/react-router'
import { TanStackRouterDevtools } from '@tanstack/router-devtools'
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import '../app/globals.css'

const queryClient = new QueryClient()

export const Route = createRootRoute({
  component: () => (
    <QueryClientProvider client={queryClient}>
      <div className="min-h-screen bg-background">
        <Outlet />
      </div>
      <TanStackRouterDevtools />
    </QueryClientProvider>
  ),
})
```

#### Step 4.2: Create Main Routes
Create `src/routes/index.tsx`:
```typescript
import { createFileRoute } from '@tanstack/react-router'
import { HomePage } from '../pages/HomePage'

export const Route = createFileRoute('/')({
  component: HomePage,
})
```

Create `src/routes/dashboard.tsx`:
```typescript
import { createFileRoute } from '@tanstack/react-router'
import { DashboardPage } from '../pages/DashboardPage'

export const Route = createFileRoute('/dashboard')({
  component: DashboardPage,
})
```

Create `src/routes/login.tsx`:
```typescript
import { createFileRoute } from '@tanstack/react-router'
import { LoginPage } from '../pages/LoginPage'

export const Route = createFileRoute('/login')({
  component: LoginPage,
})
```

#### Step 4.3: Create Page Components
Create `src/pages/HomePage.tsx`:
```typescript
import { Reveal } from '@/app/animations/Reveal'
import { Button } from '@/app/components/Button/Button'
import { ProfileImage } from '@/app/components/ProfileImage/ProfileImage'
import { Typography } from '@/app/components/Typography/Typography'
import { ArticlesSection } from '@/app/components/ArticlesSection/ArticlesSection'
import { ContactForm } from '@/app/components/ContactForm/ContactForm'
import { ProjectsSection } from '@/app/components/ProjectsSection/ProjectsSection'
import { useArticles } from '@/hooks/useArticles'

export function HomePage() {
  const { data: articles, isLoading, error } = useArticles()

  if (isLoading) return <div>Loading...</div>
  if (error) return <div>Error loading articles</div>

  return (
    <>
      {/* Your existing page content */}
      <section
        className="w-full h-screen flex flex-col items-center justify-center px-16 md:flex-row-reverse md:gap-x-[5%] scroll-mt-16 lg:scroll-mt-0"
        id="about"
      >
        {/* ... rest of your content */}
      </section>
      {/* ... other sections */}
    </>
  )
}
```

### Phase 5: Implement Data Fetching (1-2 days)

#### Step 5.1: Create API Client
Create `src/lib/api.ts`:
```typescript
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001'

export async function fetchArticles() {
  const response = await fetch(`${API_BASE_URL}/api/articles`)
  if (!response.ok) {
    throw new Error('Failed to fetch articles')
  }
  return response.json()
}

export async function sendEmail(data: any) {
  const response = await fetch(`${API_BASE_URL}/api/email`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(data),
  })
  if (!response.ok) {
    throw new Error('Failed to send email')
  }
  return response.json()
}
```

#### Step 5.2: Create React Query Hooks
Create `src/hooks/useArticles.ts`:
```typescript
import { useQuery } from '@tanstack/react-query'
import { fetchArticles } from '@/lib/api'

export const useArticles = () => {
  return useQuery({
    queryKey: ['articles'],
    queryFn: fetchArticles,
    staleTime: 5 * 60 * 1000, // 5 minutes
  })
}
```

Create `src/hooks/useEmailMutation.ts`:
```typescript
import { useMutation } from '@tanstack/react-query'
import { sendEmail } from '@/lib/api'

export const useEmailMutation = () => {
  return useMutation({
    mutationFn: sendEmail,
    onSuccess: () => {
      console.log('Email sent successfully')
    },
    onError: (error) => {
      console.error('Failed to send email:', error)
    },
  })
}
```

### Phase 6: Setup API Routes (1 day)

#### Option A: Separate Express Server
Create `server/index.js`:
```javascript
const express = require('express')
const cors = require('cors')
const app = express()

app.use(cors())
app.use(express.json())

app.get('/api/articles', (req, res) => {
  // Your articles logic here
  res.json([])
})

app.post('/api/email', (req, res) => {
  // Your email logic here
  res.json({ success: true })
})

app.listen(3001, () => {
  console.log('Server running on port 3001')
})
```

#### Option B: Use Vite Proxy (for development)
Configure in `vite.config.ts` as shown in Phase 2.

### Phase 7: Styling and Assets Migration (1 day)

#### Step 7.1: Copy Global Styles
Copy `src/app/globals.css` to `src/styles/globals.css`

#### Step 7.2: Update Asset Imports
```typescript
// Instead of Next.js Image optimization
import profileImage from '@/assets/me.png'

// Use regular img tag
<img src={profileImage} alt="Profile" />
```

#### Step 7.3: Configure PostCSS
Create `postcss.config.js`:
```javascript
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### Phase 8: Testing and Optimization (1-2 days)

#### Step 8.1: Update Test Configuration
Update `vitest.config.mts`:
```typescript
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    setupFiles: ['./vitest.setup.ts'],
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

#### Step 8.2: Implement Code Splitting
```typescript
import { lazy, Suspense } from 'react'

const DashboardPage = lazy(() => import('./pages/DashboardPage'))

// Use with Suspense
<Suspense fallback={<div>Loading...</div>}>
  <DashboardPage />
</Suspense>
```

#### Step 8.3: Bundle Analysis
```bash
npm install -D rollup-plugin-visualizer
```

Add to `vite.config.ts`:
```typescript
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    react(),
    TanStackRouterVite(),
    visualizer({ filename: 'dist/stats.html' })
  ],
})
```

### Phase 9: Deployment Setup (1 day)

#### Option A: Vercel
1. Install Vercel CLI: `npm i -g vercel`
2. Run: `vercel`
3. Configure build settings:
   - Build Command: `npm run build`
   - Output Directory: `dist`

#### Option B: Netlify
1. Create `netlify.toml`:
```toml
[build]
  publish = "dist"
  command = "npm run build"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

#### Option C: AWS S3 + CloudFront
1. Build the project: `npm run build`
2. Upload `dist/` folder to S3 bucket
3. Configure CloudFront distribution
4. Set up custom domain

### Environment Variables

Create `.env.example`:
```env
VITE_API_URL=http://localhost:3001
VITE_CONTACT_EMAIL=your-email@example.com
```

Create `.env`:
```env
VITE_API_URL=https://your-api-domain.com
VITE_CONTACT_EMAIL=jonathan224santos@gmail.com
```

## Final Checklist

- [ ] All components migrated and working
- [ ] All routes configured and accessible
- [ ] Data fetching implemented with React Query
- [ ] Tests updated and passing
- [ ] Bundle optimized and analyzed
- [ ] Deployment configured
- [ ] Environment variables set
- [ ] SEO meta tags added (use react-helmet-async)
- [ ] Error boundaries implemented
- [ ] Loading states added
- [ ] Performance optimized

## Key Benefits After Migration

- **Cost Reduction**: Deploy on cheaper static hosting (Vercel free tier, Netlify, or S3)
- **Faster Build Times**: Vite's lightning-fast HMR and build process
- **Smaller Bundle**: Remove unused Next.js features
- **More Control**: Fine-tune exactly what you need
- **Better Developer Experience**: Faster development with Vite

## Estimated Timeline

**Total: 10-14 days** (assuming part-time work)

- Phase 1: 1-2 days
- Phase 2: 1 day  
- Phase 3: 2-3 days
- Phase 4: 2 days
- Phase 5: 1-2 days
- Phase 6: 1 day
- Phase 7: 1 day
- Phase 8: 1-2 days
- Phase 9: 1 day

## Additional Resources

- [TanStack Router Documentation](https://tanstack.com/router)
- [Vite Documentation](https://vitejs.dev/)
- [React Query Documentation](https://tanstack.com/query)
- [Tailwind CSS with Vite](https://tailwindcss.com/docs/guides/vite)